# RAG + CS ì±—ë´‡ ì„¤ê³„ì„œ

> Next.js í†µí•© ë°©ì‹ â€” ë³„ë„ Python ì„œë²„ ì—†ì´ ê¸°ì¡´ rental-admin-mvp ë‚´ì— êµ¬í˜„

---

## 1. ì™œ Next.js í†µí•©ì¸ê°€

| ê¸°ì¤€ | ë³„ë„ Python (LangChain+Streamlit) | Next.js í†µí•© |
|------|-----------------------------------|-------------|
| ì¸í”„ë¼ | ì„œë²„ 2ê°œ (Next.js + Python) | ì„œë²„ 1ê°œ |
| ë°°í¬ | Vercel + ë³„ë„ í˜¸ìŠ¤íŒ… | Vercel í•˜ë‚˜ë¡œ ë |
| ì¸ì¦ | Supabase Auth ì´ì¤‘ ì—°ë™ í•„ìš” | ê¸°ì¡´ Auth ê·¸ëŒ€ë¡œ |
| ë§¥ë½ í™œìš© | ì—†ìŒ (ë…ë¦½ ì•±) | ì–´ë“œë¯¼ ë°ì´í„° ì¦‰ì‹œ ì ‘ê·¼ |
| ìœ ì§€ë³´ìˆ˜ | Python + JS ë‘ ìŠ¤íƒ | JS í•˜ë‚˜ |
| ë¹„ìš© | ì¶”ê°€ ì„œë²„ ë¹„ìš© | ì¶”ê°€ ì—†ìŒ |

**ê²°ë¡ :** ìŠ¤íƒ€íŠ¸ì—… 1ì¸ ìš´ì˜ í™˜ê²½ì—ì„œ Next.js í†µí•©ì´ ìœ ë¦¬.

---

## 2. ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rental-admin-mvp (Next.js 14)                      â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CS ì±—ë´‡ UI  â”‚â”€â”€â”€â”€â–¶â”‚ Server Action (chat.ts)   â”‚  â”‚
â”‚  â”‚ (React)     â”‚â—€â”€â”€â”€â”€â”‚                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  1. ì‚¬ìš©ì ì§ˆë¬¸ ìˆ˜ì‹        â”‚  â”‚
â”‚                      â”‚  2. ì§ˆë¬¸ ì„ë² ë”©             â”‚  â”‚
â”‚                      â”‚  3. pgvector ìœ ì‚¬ë„ ê²€ìƒ‰    â”‚  â”‚
â”‚                      â”‚  4. ì»¨í…ìŠ¤íŠ¸ + í”„ë¡¬í”„íŠ¸ êµ¬ì„±â”‚  â”‚
â”‚                      â”‚  5. Claude API í˜¸ì¶œ        â”‚  â”‚
â”‚                      â”‚  6. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ë°˜í™˜      â”‚  â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚        â”‚               â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                     â”‚ Supabase â”‚ â”‚ Claude API   â”‚    â”‚
â”‚                     â”‚ pgvector â”‚ â”‚ (Sonnet 4.5) â”‚    â”‚
â”‚                     â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚ + OpenAI â”‚                     â”‚
â”‚                     â”‚ Embeddingâ”‚                     â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ë°ì´í„° íŒŒì´í”„ë¼ì¸ (ë¬¸ì„œ â†’ ë²¡í„°)

### 3-1. ëŒ€ìƒ ë¬¸ì„œ

STR-ì •ì±… í´ë”ì˜ MD íŒŒì¼ 19ê°œ (ì´ ~350KB). ë¬¸ì„œë³„ ì—­í• :

| ë¬¸ì„œ | ìš©ë„ | ìš°ì„ ìˆœìœ„ |
|------|------|---------|
| FAQ.md | CS ì‘ëŒ€ í•µì‹¬ (Q&A ìŒ) | P0 |
| ìš´ì˜-1_ë§¤ë¬¼ê²€ìˆ˜.md | ë§¤ë¬¼ ê²€ìˆ˜ ì •ì±… | P0 |
| ì •ì±…-1_ë²•ì ê¸°ì¤€.md | ë²•ì  ê¸°ì¤€ | P0 |
| ì •ì±…-2_ê°€ê²©ì •ì±….md | ìˆ˜ìˆ˜ë£Œ/ì •ì‚° | P0 |
| ì •ì±…-3_ê¸°íƒ€ì •ì±….md | ê¸°íƒ€ ìš´ì˜ ì •ì±… | P0 |
| ìš´ì˜-2_í˜¸ìŠ¤íŠ¸ê²ŒìŠ¤íŠ¸ê´€ë¦¬.md | í˜¸ìŠ¤íŠ¸/ê²ŒìŠ¤íŠ¸ ê´€ë¦¬ | P1 |
| H1.md | ê¸ˆì¹™ì–´, ë°˜ë ¤ì‚¬ìœ  | P1 |
| Note.md | ë‚´ë¶€ ì•„ì´ë””ì–´/ë©”ëª¨ | P2 |
| FAQ-íƒ€ì‚¬.md | íƒ€ì‚¬ ì •ì±… ì°¸ê³  | P2 |
| ì •ì±…-íƒ€ì‚¬A.md | íƒ€ì‚¬ ìƒì„¸ ë¹„êµ | P2 |
| ë‚˜ë¨¸ì§€ | ì°¸ê³ ìš© | P3 |

### 3-2. ì²­í‚¹ ì „ëµ

**FAQ.mdëŠ” íŠ¹ë³„ ì²˜ë¦¬** â€” Q&A ìŒì„ í•˜ë‚˜ì˜ ì²­í¬ë¡œ ìœ ì§€:
```
Q: ìµœì†Œ ê³„ì•½ ê¸°ê°„ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
A: ìµœì†Œ ê³„ì•½ê¸°ê°„ì€ 1ì£¼ì¼ì…ë‹ˆë‹¤. 1ì£¼ì¼ ì´ìƒ ê³„ì•½ì„ ì§„í–‰ í•´ì£¼ì„¸ìš”.
â†’ í•˜ë‚˜ì˜ ë²¡í„° ë ˆì½”ë“œ (Q+A í•©ì³ì„œ)
```

**ë‚˜ë¨¸ì§€ ì •ì±… ë¬¸ì„œ** â€” í—¤ë” ê¸°ë°˜ ë¶„í• :
```
# ì •ì±…-1 ë²•ì  ê¸°ì¤€
## 1-1. ê°€ëŠ¥ ë§¤ë¬¼ ê¸°ì¤€
[ì´ ì„¹ì…˜ ì „ì²´ê°€ í•˜ë‚˜ì˜ ì²­í¬]
## 1-2. ê³„ì•½ ê¸°ê°„ ê¸°ì¤€
[ì´ ì„¹ì…˜ ì „ì²´ê°€ í•˜ë‚˜ì˜ ì²­í¬]
```

**ì²­í¬ ì„¤ì •:**
- ìµœëŒ€ ì²­í¬ í¬ê¸°: 1,500ì (í•œêµ­ì–´ ê¸°ì¤€ ~500í† í°)
- ì˜¤ë²„ë©: 200ì (ì„¹ì…˜ ê²½ê³„ ë§¥ë½ ìœ ì§€)
- FAQëŠ” Q+A ìŒ ë‹¨ìœ„ë¡œ ë¶„í•  (í¬ê¸° ë¬´ì‹œ)

### 3-3. ë©”íƒ€ë°ì´í„°

ê° ë²¡í„°ì— ì €ì¥í•  ë©”íƒ€ë°ì´í„°:

```typescript
{
  source_file: "FAQ.md",          // ì›ë³¸ íŒŒì¼ëª…
  category: "faq",                // faq | policy | operation | reference
  target: "common",               // common | host | guest
  section_title: "ê³„ì•½ > ìµœì†Œ ê³„ì•½ ê¸°ê°„",  // ì„¹ì…˜ ê²½ë¡œ
  priority: 0,                    // 0=í•µì‹¬, 1=ì¤‘ìš”, 2=ì°¸ê³ 
  content_type: "qa_pair",        // qa_pair | policy_rule | reference
}
```

**ë©”íƒ€ë°ì´í„°ê°€ ì¤‘ìš”í•œ ì´ìœ :** ê²€ìƒ‰ ì‹œ í•„í„°ë§ ê°€ëŠ¥.
- í˜¸ìŠ¤íŠ¸ê°€ ë¬¼ì–´ë³´ë©´ â†’ `target IN ('common', 'host')`
- ê°€ê²© ì§ˆë¬¸ì´ë©´ â†’ `category = 'policy'` + `source_file = 'ì •ì±…-2_ê°€ê²©ì •ì±….md'`

---

## 4. DB ìŠ¤í‚¤ë§ˆ

### 4-1. pgvector í…Œì´ë¸”

```sql
-- pgvector í™•ì¥ í™œì„±í™”
create extension if not exists vector;

-- ë¬¸ì„œ ì²­í¬ + ë²¡í„° í…Œì´ë¸”
create table policy_embeddings (
  id bigint generated always as identity primary key,
  content text not null,                    -- ì›ë¬¸ í…ìŠ¤íŠ¸
  embedding vector(1536),                   -- OpenAI text-embedding-3-small
  source_file text not null,                -- ì›ë³¸ íŒŒì¼ëª…
  category text not null,                   -- faq, policy, operation, reference
  target text default 'common',             -- common, host, guest
  section_title text,                       -- ì„¹ì…˜ ì œëª©/ê²½ë¡œ
  priority int default 1,                   -- 0=í•µì‹¬, 1=ì¤‘ìš”, 2=ì°¸ê³ 
  content_type text default 'policy_rule',  -- qa_pair, policy_rule, reference
  token_count int,                          -- í† í° ìˆ˜ (ë¹„ìš© ì¶”ì ìš©)
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- ë²¡í„° ê²€ìƒ‰ ì¸ë±ìŠ¤ (IVFFlat â€” ì†Œê·œëª¨ ë°ì´í„°ì— ì í•©)
create index on policy_embeddings
  using ivfflat (embedding vector_cosine_ops)
  with (lists = 10);

-- ë©”íƒ€ë°ì´í„° í•„í„° ì¸ë±ìŠ¤
create index idx_pe_category on policy_embeddings(category);
create index idx_pe_priority on policy_embeddings(priority);
create index idx_pe_source on policy_embeddings(source_file);
```

### 4-2. ëŒ€í™” ì´ë ¥ í…Œì´ë¸”

```sql
create table chat_sessions (
  id uuid default gen_random_uuid() primary key,
  admin_user_id uuid references auth.users(id),
  title text,                               -- ìë™ ìƒì„± ì œëª©
  context_property_id uuid,                 -- ë§¤ë¬¼ ìƒì„¸ì—ì„œ ì‹œì‘í•œ ê²½ìš°
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

create table chat_messages (
  id bigint generated always as identity primary key,
  session_id uuid references chat_sessions(id) on delete cascade,
  role text not null check (role in ('user', 'assistant')),
  content text not null,
  sources jsonb,                            -- ì°¸ì¡°í•œ ë¬¸ì„œ ì²­í¬ IDs
  created_at timestamptz default now()
);

-- RLS
alter table chat_sessions enable row level security;
alter table chat_messages enable row level security;

create policy "Admin can manage own sessions"
  on chat_sessions for all
  using (admin_user_id = auth.uid());

create policy "Admin can manage own messages"
  on chat_messages for all
  using (
    session_id in (
      select id from chat_sessions where admin_user_id = auth.uid()
    )
  );
```

### 4-3. ìœ ì‚¬ë„ ê²€ìƒ‰ í•¨ìˆ˜

```sql
create or replace function match_policy_documents(
  query_embedding vector(1536),
  match_count int default 5,
  filter_category text default null,
  filter_priority int default null
)
returns table (
  id bigint,
  content text,
  source_file text,
  category text,
  section_title text,
  priority int,
  content_type text,
  similarity float
)
language plpgsql
as $$
begin
  return query
  select
    pe.id,
    pe.content,
    pe.source_file,
    pe.category,
    pe.section_title,
    pe.priority,
    pe.content_type,
    1 - (pe.embedding <=> query_embedding) as similarity
  from policy_embeddings pe
  where
    (filter_category is null or pe.category = filter_category)
    and (filter_priority is null or pe.priority <= filter_priority)
  order by pe.embedding <=> query_embedding
  limit match_count;
end;
$$;
```

---

## 5. ì½”ë“œ êµ¬ì¡°

```
rental-admin-mvp/
â”œâ”€â”€ lib/rag/
â”‚   â”œâ”€â”€ embeddings.ts          â† OpenAI Embedding API í˜¸ì¶œ
â”‚   â”œâ”€â”€ vector-search.ts       â† Supabase pgvector ê²€ìƒ‰
â”‚   â”œâ”€â”€ chat.ts                â† Claude API í˜¸ì¶œ + í”„ë¡¬í”„íŠ¸ êµ¬ì„±
â”‚   â”œâ”€â”€ chunker.ts             â† MD â†’ ì²­í¬ ë¶„í•  ë¡œì§
â”‚   â””â”€â”€ types.ts               â† RAG ê´€ë ¨ íƒ€ì… ì •ì˜
â”œâ”€â”€ app/admin/cs-chatbot/
â”‚   â”œâ”€â”€ page.tsx               â† ì±—ë´‡ ë©”ì¸ í˜ì´ì§€ (ì„¸ì…˜ ëª©ë¡ + ì±„íŒ…)
â”‚   â”œâ”€â”€ actions.ts             â† ì„œë²„ ì•¡ì…˜ (sendMessage, createSession)
â”‚   â””â”€â”€ chat-interface.tsx     â† ì±„íŒ… UI í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ ingest-policies.ts     â† ì •ì±… ë¬¸ì„œ ì„ë² ë”© ìŠ¤í¬ë¦½íŠ¸ (CLI)
â””â”€â”€ supabase/migrations/
    â””â”€â”€ 20260214000000_add_rag_system.sql
```

### 5-1. í•µì‹¬ ëª¨ë“ˆ ì„¤ëª…

**`lib/rag/embeddings.ts`**
```typescript
// OpenAI text-embedding-3-small í˜¸ì¶œ
// ì…ë ¥: í…ìŠ¤íŠ¸ (ì§ˆë¬¸ or ë¬¸ì„œ ì²­í¬)
// ì¶œë ¥: 1536ì°¨ì› ë²¡í„°
export async function getEmbedding(text: string): Promise<number[]>

// ë°°ì¹˜ ì„ë² ë”© (ë¬¸ì„œ ì¸ì œìŠ¤íŠ¸ ì‹œ)
export async function getEmbeddings(texts: string[]): Promise<number[][]>
```

**`lib/rag/vector-search.ts`**
```typescript
// pgvector ìœ ì‚¬ë„ ê²€ìƒ‰
// ì§ˆë¬¸ ì„ë² ë”© â†’ match_policy_documents RPC í˜¸ì¶œ
// í•„í„°: category, priority
export async function searchPolicies(
  query: string,
  options?: { category?: string; topK?: number; minSimilarity?: number }
): Promise<PolicyChunk[]>
```

**`lib/rag/chat.ts`**
```typescript
// RAG íŒŒì´í”„ë¼ì¸ ì „ì²´ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
// 1. ì§ˆë¬¸ â†’ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ (ê°„ë‹¨í•œ í‚¤ì›Œë“œ ë§¤ì¹­)
// 2. ì§ˆë¬¸ â†’ ì„ë² ë”© â†’ ë²¡í„° ê²€ìƒ‰
// 3. ê²€ìƒ‰ ê²°ê³¼ + ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ëŒ€í™” ì´ë ¥ â†’ Claude í˜¸ì¶œ
// 4. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
export async function chat(
  sessionId: string,
  userMessage: string,
  contextPropertyId?: string   // ë§¤ë¬¼ ë§¥ë½ì´ ìˆëŠ” ê²½ìš°
): Promise<ReadableStream>
```

**`lib/rag/chunker.ts`**
```typescript
// MD íŒŒì¼ â†’ ì²­í¬ ë¶„í• 
// FAQ.md: Q+A ìŒ ë‹¨ìœ„
// ë‚˜ë¨¸ì§€: í—¤ë”(##) ê¸°ë°˜ ë¶„í•  + ì˜¤ë²„ë©
export function chunkMarkdown(
  content: string,
  filename: string,
  options?: { maxChars?: number; overlap?: number }
): DocumentChunk[]
```

**`scripts/ingest-policies.ts`**
```typescript
// CLI ìŠ¤í¬ë¦½íŠ¸: npx tsx scripts/ingest-policies.ts
// 1. STR-ì •ì±… í´ë”ì—ì„œ MD íŒŒì¼ ì½ê¸°
// 2. chunkerë¡œ ë¶„í• 
// 3. ë©”íƒ€ë°ì´í„° ìë™ íƒœê¹… (íŒŒì¼ëª… â†’ category ë§¤í•‘)
// 4. OpenAIë¡œ ë°°ì¹˜ ì„ë² ë”©
// 5. Supabaseì— upsert
// 6. ê²°ê³¼ ìš”ì•½ ì¶œë ¥
```

---

## 6. Claude í”„ë¡¬í”„íŠ¸ ì„¤ê³„

### 6-1. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸

```
ë‹¹ì‹ ì€ ì§ë°© ë‹¨ê¸°ì„ëŒ€(STR) ì„œë¹„ìŠ¤ì˜ CS ì „ë¬¸ ìƒë‹´ì›ì…ë‹ˆë‹¤.

## ì—­í• 
- í˜¸ìŠ¤íŠ¸ì™€ ê²ŒìŠ¤íŠ¸ì˜ ì§ˆë¬¸ì— ì •ì±… ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤
- ëª¨ë¥´ëŠ” ë‚´ìš©ì€ "í™•ì¸ í›„ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤"ë¼ê³  ë‹µí•©ë‹ˆë‹¤
- ì ˆëŒ€ ì •ì±…ì— ì—†ëŠ” ë‚´ìš©ì„ ì¶”ì¸¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤

## í†¤ì•¤ë§¤ë„ˆ
- ì°¨ê°‘ì§€ ì•Šë˜, ì±…ì„ì€ ì •í™•íˆ êµ¬ë¶„
- "í”Œë«í¼ì´ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤" ëŒ€ì‹  "í˜¸ìŠ¤íŠ¸ì™€ ê²ŒìŠ¤íŠ¸ ê°„ í•©ì˜ ì›ì¹™"ìœ¼ë¡œ ì•ˆë‚´
- ì¡´ëŒ“ë§, ì¹œì ˆí•˜ë˜ ì „ë¬¸ì 

## ë‹µë³€ ê·œì¹™
1. ë°˜ë“œì‹œ [ì°¸ì¡° ë¬¸ì„œ]ì— ê·¼ê±°í•´ì„œ ë‹µë³€í•˜ì„¸ìš”
2. ì°¸ì¡° ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš©ì€ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”
3. ê¸ˆì•¡, ê¸°ê°„, ìˆ˜ìˆ˜ë£Œ ë“± ìˆ«ìëŠ” ì •í™•íˆ ì¸ìš©í•˜ì„¸ìš”
4. ë‹µë³€ ëì— ì°¸ì¡°í•œ ë¬¸ì„œë¥¼ í‘œì‹œí•˜ì„¸ìš”: ğŸ“„ ì¶œì²˜: {source_file} > {section_title}

## ì£¼ì˜ì‚¬í•­
- ë²•ë¥  ìë¬¸ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë²•ì  íŒë‹¨ì´ í•„ìš”í•œ ê²½ìš° ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œìœ í•˜ì„¸ìš”.
- ê°œì¸ì •ë³´ë¥¼ ë¬»ê±°ë‚˜ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤
- íƒ€ì‚¬ ì„œë¹„ìŠ¤ ë¹„êµ ì§ˆë¬¸ì€ "ì§ë°© ë‹¨ê¸°ì„ëŒ€ ì •ì±… ê¸°ì¤€ìœ¼ë¡œ" ë‹µë³€í•˜ì„¸ìš”
```

### 6-2. ì‚¬ìš©ì ë©”ì‹œì§€ êµ¬ì„±

```
[ì°¸ì¡° ë¬¸ì„œ]
---
{ê²€ìƒ‰ëœ ì •ì±… ì²­í¬ 1}
ì¶œì²˜: {source_file} > {section_title}
---
{ê²€ìƒ‰ëœ ì •ì±… ì²­í¬ 2}
ì¶œì²˜: {source_file} > {section_title}
---
{ê²€ìƒ‰ëœ ì •ì±… ì²­í¬ 3~5}
---

[ì´ì „ ëŒ€í™”]
ì‚¬ìš©ì: {ì´ì „ ì§ˆë¬¸}
ìƒë‹´ì›: {ì´ì „ ë‹µë³€}

[í˜„ì¬ ì§ˆë¬¸]
{ì‚¬ìš©ìì˜ ìƒˆ ì§ˆë¬¸}
```

### 6-3. ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ (í‚¤ì›Œë“œ ê¸°ë°˜)

ê²€ìƒ‰ ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´, ì§ˆë¬¸ì„ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜í•˜ì—¬ í•„í„°ë§:

```typescript
const CATEGORY_KEYWORDS = {
  faq: ["ì–´ë–»ê²Œ", "ë­", "ë¬´ì—‡", "ê°€ëŠ¥", "ë¶ˆê°€", "í•  ìˆ˜"],
  policy_price: ["ìˆ˜ìˆ˜ë£Œ", "ê°€ê²©", "ìš”ê¸ˆ", "ì •ì‚°", "ê²°ì œ", "í™˜ë¶ˆ", "ë³´ì¦ê¸ˆ"],
  policy_legal: ["ë²•", "ë“±ë¡", "ë§¤ë¬¼", "í˜¸í…”", "ìˆ™ë°•", "ìœ„ë°˜"],
  operation: ["ê²€ìˆ˜", "ìŠ¹ì¸", "ë°˜ë ¤", "ê¸ˆì¹™ì–´", "ì‚¬ì§„", "ë³´ì™„"],
};
```

---

## 7. CS ì±—ë´‡ UI ì„¤ê³„

### 7-1. í˜ì´ì§€ ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [í—¤ë”]  ëŒ€ì‹œë³´ë“œ | ë§¤ë¬¼ê´€ë¦¬ | CSì±—ë´‡ | ì„¤ì •       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì„¸ì…˜ ëª©ë¡  â”‚  ì±„íŒ… ì˜ì—­                           â”‚
â”‚            â”‚                                     â”‚
â”‚ â—‹ ê³„ì•½ë¬¸ì˜ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   2/13     â”‚  â”‚ ğŸ¤– ì•ˆë…•í•˜ì„¸ìš”! ì§ë°© ë‹¨ê¸°ì„ëŒ€     â”‚â”‚
â”‚ â—‹ í™˜ë¶ˆì •ì±… â”‚  â”‚    CS ë„ìš°ë¯¸ì…ë‹ˆë‹¤.              â”‚â”‚
â”‚   2/12     â”‚  â”‚                                 â”‚â”‚
â”‚            â”‚  â”‚ ğŸ‘¤ ìµœì†Œ ê³„ì•½ ê¸°ê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?â”‚â”‚
â”‚            â”‚  â”‚                                 â”‚â”‚
â”‚ [+ ìƒˆ ëŒ€í™”]â”‚  â”‚ ğŸ¤– ìµœì†Œ ê³„ì•½ê¸°ê°„ì€ 1ì£¼ì¼ì…ë‹ˆë‹¤.  â”‚â”‚
â”‚            â”‚  â”‚    1ì£¼ì¼ ì´ìƒ ê³„ì•½ì„ ì§„í–‰í•´       â”‚â”‚
â”‚            â”‚  â”‚    ì£¼ì„¸ìš”.                       â”‚â”‚
â”‚            â”‚  â”‚    ğŸ“„ ì¶œì²˜: FAQ.md > ê³„ì•½        â”‚â”‚
â”‚            â”‚  â”‚                                 â”‚â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚  â”‚ ë©”ì‹œì§€ ì…ë ¥...          [ì „ì†¡]   â”‚â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í•˜ë‹¨] ğŸ“Š ì •ì±… ë¬¸ì„œ 19ê°œ ë¡œë“œë¨ | ìµœì¢… ì—…ë°ì´íŠ¸: ~â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7-2. ì£¼ìš” ê¸°ëŠ¥

1. **ëŒ€í™” ì„¸ì…˜ ê´€ë¦¬**: ì„¸ì…˜ ìƒì„±/ëª©ë¡/ì‚­ì œ
2. **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ**: Claude ì‘ë‹µì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œ
3. **ì¶œì²˜ í‘œì‹œ**: ê° ë‹µë³€ì— ì°¸ì¡°í•œ ì •ì±… ë¬¸ì„œ ì¶œì²˜ ë§í¬
4. **ë§¤ë¬¼ ë§¥ë½ ì—°ë™**: ë§¤ë¬¼ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì´ ë§¤ë¬¼ì— ëŒ€í•´ ì§ˆë¬¸" ë²„íŠ¼ â†’ ì±—ë´‡ì— ë§¤ë¬¼ ì •ë³´ ìë™ ì „ë‹¬
5. **ë¹ ë¥¸ ì§ˆë¬¸**: FAQ ê¸°ë°˜ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ë²„íŠ¼ (ì²« í™”ë©´)
6. **ì–´ë“œë¯¼ ì „ìš©**: Supabase Auth ì¸ì¦ í•„ìš” (ê¸°ì¡´ ì–´ë“œë¯¼ ë¡œê·¸ì¸)

### 7-3. ë§¤ë¬¼ ë§¥ë½ ì—°ë™ (ë³´ë„ˆìŠ¤)

ë§¤ë¬¼ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‹œì‘í•˜ë©´:
```
[ìë™ ì»¨í…ìŠ¤íŠ¸]
í˜„ì¬ ë³´ê³  ìˆëŠ” ë§¤ë¬¼: {ë§¤ë¬¼ëª…}
ì£¼ì†Œ: {ì£¼ì†Œ}
ìƒíƒœ: {ê²€ìˆ˜ë³´ì™„}
ê²€ìˆ˜ ê²°ê³¼: {ìœ„ë°˜ ì‚¬í•­ ìš”ì•½}

ì´ ë§¤ë¬¼ì— ëŒ€í•´ ì§ˆë¬¸í•´ë³´ì„¸ìš”.
ì˜ˆ: "ì´ ë§¤ë¬¼ì˜ ë°˜ë ¤ ì‚¬ìœ ë¥¼ í˜¸ìŠ¤íŠ¸ì—ê²Œ ì–´ë–»ê²Œ ì•ˆë‚´í• ê¹Œìš”?"
```

---

## 8. ì¶”ê°€ í™˜ê²½ ë³€ìˆ˜

```env
# ê¸°ì¡´
OPENAI_API_KEY=sk-...          # ì´ë¯¸ ìˆìŒ (AI ê²€ìˆ˜ìš©)

# ì¶”ê°€
ANTHROPIC_API_KEY=sk-ant-...   # Claude Sonnet 4.5 (ì±—ë´‡ ì‘ë‹µìš©)
```

Supabase, OpenAIëŠ” ì´ë¯¸ í”„ë¡œì íŠ¸ì— ì—°ë™ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì¶”ê°€ ì„¤ì • ìµœì†Œí™”.

---

## 9. ì˜ˆìƒ ë¹„ìš©

| í•­ëª© | ì˜ˆìƒ ì›” ë¹„ìš© | ë¹„ê³  |
|------|-------------|------|
| OpenAI Embedding | ~$1 | ì •ì±… ë¬¸ì„œ 350KB, ì¬ì¸ì œìŠ¤íŠ¸ ë“œë¬¾ |
| Claude Sonnet 4.5 | ~$10-20 | í•˜ë£¨ ~50ê±´ ì§ˆì˜ ê¸°ì¤€ |
| Supabase | $0 (Free tier) | pgvector í¬í•¨ |
| **í•©ê³„** | **~$11-21/ì›”** | |

---

## 10. êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ë²¡í„° ì¸í”„ë¼ (1ì¼)
- [ ] DB ë§ˆì´ê·¸ë ˆì´ì…˜ (pgvector, í…Œì´ë¸”, í•¨ìˆ˜)
- [ ] `lib/rag/types.ts` íƒ€ì… ì •ì˜
- [ ] `lib/rag/embeddings.ts` OpenAI ì„ë² ë”© ëª¨ë“ˆ
- [ ] `lib/rag/chunker.ts` ë§ˆí¬ë‹¤ìš´ ì²­í‚¹
- [ ] `scripts/ingest-policies.ts` ì¸ì œìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] ì‹¤í–‰í•˜ì—¬ 19ê°œ ë¬¸ì„œ ì„ë² ë”© ì™„ë£Œ

### Phase 2: ê²€ìƒ‰ + ì‘ë‹µ (1ì¼)
- [ ] `lib/rag/vector-search.ts` ìœ ì‚¬ë„ ê²€ìƒ‰
- [ ] `lib/rag/chat.ts` Claude RAG íŒŒì´í”„ë¼ì¸
- [ ] `app/admin/cs-chatbot/actions.ts` ì„œë²„ ì•¡ì…˜

### Phase 3: ì±—ë´‡ UI (1-2ì¼)
- [ ] `app/admin/cs-chatbot/page.tsx` ë©”ì¸ í˜ì´ì§€
- [ ] `app/admin/cs-chatbot/chat-interface.tsx` ì±„íŒ… ì»´í¬ë„ŒíŠ¸
- [ ] ë„¤ë¹„ê²Œì´ì…˜ ì¶”ê°€ (layout.tsx)
- [ ] ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ êµ¬í˜„

### Phase 4: ê³ ë„í™” (ì´í›„)
- [ ] ë§¤ë¬¼ ë§¥ë½ ì—°ë™
- [ ] ë¹ ë¥¸ ì§ˆë¬¸ ë²„íŠ¼
- [ ] ë‹µë³€ í”¼ë“œë°± (ì¢‹ì•„ìš”/ë‚˜ë¹ ìš”)
- [ ] ì •ì±… ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì‹œ ìë™ ì¬ì¸ì œìŠ¤íŠ¸
